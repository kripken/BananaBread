<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8" />
</head>
<body>
	<div id="sessions">
	</div>
</body>
<script>
	var brokerUrl = 'http://modeswit.ch:3000';
	if(window.location.search) {
	  var params = window.location.search.substring(1).split('&');
	  for(var i = 0; i < params.length; ++ i) {
	    if(params[i].match('^webrtc-broker')) {
	      brokerUrl = params[i].split('=')[1];
	    }
	  }
	}

	console.log(brokerUrl);

	var xhr = new XMLHttpRequest();
	xhr.open('GET', brokerUrl + '/list?application=bananabread');
	xhr.onreadystatechange = function() {
		if(4 !== xhr.readyState) return;
		if(!(200 === xhr.status || 201 === xhr.status)) {
      console.error(xhr.statusText + ': ' + xhr.responseText);
    }

    display(JSON.parse(xhr.responseText));
	};
	xhr.send(null);

	function display(sessions) {
		sessions = sessions || [];		
		sessions.forEach(function(session) {
			console.info(session);
			var div = document.getElementById('sessions');
			var node = document.createElement('div');
			node.innerHTML = new Date(session['created']).toString() + '|' + session['application'] + '|' + '<a href="' + session['url'] + '">join</a>';
			div.appendChild(node);
		});
	};
</script>
</html>